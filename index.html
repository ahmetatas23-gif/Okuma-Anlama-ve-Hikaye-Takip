<!DOCTYPE html>
<html lang="tr">
  <head>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Okuma Anlama Test Sistemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase JavaScript SDK -->

    <!-- Supabase Configuration -->
    <script src="supabase-config.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap' );
      body {
        font-family: 'Inter', sans-serif;
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .success-animation {
        animation: successPulse 0.6s ease-out;
      }
      @keyframes successPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }
      .progress-bar {
        transition: width 0.3s ease;
      }
      .question-card {
        transition: all 0.3s ease;
      }
      .question-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b-4 border-blue-500">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <h1 class="text-2xl font-bold text-blue-600">
                📚 Dijital Okuma Anlama ve Hikaye Takip Platformu
              </h1>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- User Selection Screen -->
      <div id="userSelection" class="fade-in">
        <div class="text-center mb-12">
          <h2 class="text-4xl font-bold text-gray-800 mb-4">Hoş Geldiniz!</h2>
          <p class="text-xl text-gray-600">Lütfen kullanıcı tipinizi seçin</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
          <div
            class="bg-white rounded-xl shadow-lg p-8 text-center hover:shadow-xl transition-shadow cursor-pointer"
            onclick="showTeacherPanel()"
          >
            <div class="text-6xl mb-4">👨‍🏫</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Öğretmen</h3>
            <p class="text-gray-600">
              Metin ekle, test oluştur, öğrenci performansını takip et
            </p>
          </div>

          <div
            class="bg-white rounded-xl shadow-lg p-8 text-center hover:shadow-xl transition-shadow cursor-pointer"
            onclick="showStudentPanel()"
          >
            <div class="text-6xl mb-4">👨‍🎓👩‍🎓</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Öğrenci</h3>
            <p class="text-gray-600">
              Atanan testleri çöz, performansını görüntüle
            </p>
          </div>
        </div>
      </div>

      <!-- Teacher Panel -->
      <div id="teacherPanel" class="hidden">
        <div class="flex justify-between items-center mb-8">
          <div>
            <h2 class="text-3xl font-bold text-gray-800">👨‍🏫 Öğretmen Paneli</h2>
            <p class="text-sm text-gray-600 mt-1">
              Hoş geldiniz,
              <span class="font-medium text-blue-600">Ahmet ATAS</span>
            </p>
          </div>
          <div class="flex gap-3">
            <button
              onclick="showSupabaseConfig()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"
            >
              🔧 Supabase Ayarları
            </button>
            <button
              onclick="showDataManagement()"
              class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"
            >
              💾 Veri Yönetimi
            </button>
            <button
              onclick="teacherLogout()"
              class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"
            >
              🚪 Güvenli Çıkış
            </button>
            <button
              onclick="showUserSelection()"
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"
            >
              Geri Dön
            </button>
          </div>
        </div>

        <!-- Teacher Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
          <div class="flex border-b">
            <button
              onclick="showTextInput()"
              class="teacher-tab px-6 py-3 font-medium text-blue-600 border-b-2 border-blue-600"
            >
              Metin & Test Oluştur
            </button>
            <button
              onclick="showStudentManagement()"
              class="teacher-tab px-6 py-3 font-medium text-gray-500 hover:text-blue-600"
            >
              Öğrenci Yönetimi
            </button>
            <button
              onclick="showResults()"
              class="teacher-tab px-6 py-3 font-medium text-gray-500 hover:text-blue-600"
            >
              Sonuçlar
            </button>
          </div>
        </div>

        <!-- Text Input Module -->
        <div id="textInputModule" class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-xl font-bold mb-4">📝 Metin Giriş ve Test Üretimi</h3>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Metin Başlığı</label
            >
            <input
              type="text"
              id="textTitle"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Test başlığını girin..."
            />
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >Metin İçeriği</label
            >
            <textarea
              id="textContent"
              rows="8"
              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Metni buraya yapıştırın veya yazın..."
            ></textarea>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2"
              >📖 Metin Görüntüleme Ayarları</label
            >
            <div class="bg-blue-50 p-4 rounded-lg space-y-3">
              <div class="text-sm text-blue-800 font-medium mb-3">
                Öğrenci teste başladığında metin nasıl gösterilsin?
              </div>

              <label class="flex items-start gap-3 cursor-pointer">
                <input
                  type="radio"
                  name="textDisplay"
                  value="withQuestions"
                  checked
                  class="mt-1"
                  onchange="updateTextDisplayInfo()"
                />
                <div>
                  <div class="font-medium text-gray-800">
                    📄 Her Soruyla Birlikte Metni Göster
                  </div>
                  <div class="text-sm text-gray-600">
                    Klasik mod - Her soru sayfasında metin görünür (Varsayılan)
                  </div>
                </div>
              </label>

              <label class="flex items-start gap-3 cursor-pointer">
                <input
                  type="radio"
                  name="textDisplay"
                  value="firstPageOnly"
                  class="mt-1"
                  onchange="updateTextDisplayInfo()"
                />
                <div>
                  <div class="font-medium text-gray-800">
                    📋 Sadece İlk Sayfada Metni Göster
                  </div>
                  <div class="text-sm text-gray-600">
                    Öğrenci önce metni okur, sonra sorulara geçer
                  </div>
                </div>
              </label>

              <label class="flex items-start gap-3 cursor-pointer">
                <input
                  type="radio"
                  name="textDisplay"
                  value="noText"
                  class="mt-1"
                  onchange="updateTextDisplayInfo()"
                />
                <div>
                  <div class="font-medium text-gray-800">
                    🚫 Metni Hiç Gösterme, Doğrudan Sorulara Geç
                  </div>
                  <div class="text-sm text-gray-600">
                    Metin hiç gösterilmez - Sadece sorular görünür
                  </div>
                </div>
              </label>

              <div
                id="textDisplayInfo"
                class="mt-3 p-3 bg-white rounded border-l-4 border-blue-500"
              >
                <div class="text-sm text-gray-700">
                  <strong>📄 Seçili Mod:</strong> Her soruyla birlikte metin
                  gösterilecek. Bu klasik okuma-anlama test formatıdır.
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-4 mb-6">
            <button
              onclick="generateTest()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium"
            >
              🤖 Otomatik Test Oluştur
            </button>
            <button
              onclick="showImportOptions()"
              class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium"
            >
              📁 İçe Aktar
            </button>
            <button
              onclick="exportTest()"
              class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-medium"
            >
              💾 Dışa Aktar
            </button>
          </div>

          <!-- Generated Test Preview -->
          <div id="testPreview" class="hidden">
            <h4 class="text-lg font-bold mb-4">
              📋 Oluşturulan Test Önizlemesi
            </h4>
            <div id="previewContent" class="space-y-4"></div>
            <div class="mt-6 flex gap-4">
              <button
                onclick="saveTest()"
                class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium"
              >
                ✅ Testi Kaydet
              </button>
              <button
                onclick="editTest()"
                class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg font-medium"
              >
                ✏️ Düzenle
              </button>
            </div>
          </div>
        </div>

        <!-- Student Management -->
        <div
          id="studentManagement"
          class="hidden bg-white rounded-lg shadow-md p-6"
        >
          <h3 class="text-xl font-bold mb-4">👥 Öğrenci Yönetimi</h3>

          <div class="grid lg:grid-cols-3 gap-6">
            <!-- Student List -->
            <div class="lg:col-span-2">
              <div class="flex justify-between items-center mb-3">
                <h4 class="font-bold">Kayıtlı Öğrenciler</h4>
                <div class="flex gap-2">
                  <button
                    onclick="showBulkImport()"
                    class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm"
                  >
                    📤 Toplu Ekle
                  </button>
                  <button
                    onclick="exportStudents()"
                    class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm"
                  >
                    📄 Dışa Aktar
                  </button>
                </div>
              </div>
              <div
                id="studentList"
                class="space-y-2 max-h-80 overflow-y-auto border rounded-lg p-3"
              >
                <!-- Students will be populated here -->
              </div>

              <!-- Individual Student Add Form -->
              <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                <h5 class="font-bold mb-3">👤 Yeni Öğrenci Ekle</h5>
                <div class="grid md:grid-cols-2 gap-3">
                  <input
                    type="text"
                    id="newStudentName"
                    placeholder="Ad"
                    class="p-2 border rounded-lg"
                  />
                  <input
                    type="text"
                    id="newStudentSurname"
                    placeholder="Soyad"
                    class="p-2 border rounded-lg"
                  />
                  <input
                    type="text"
                    id="newStudentTC"
                    placeholder="TC Kimlik No (11 haneli)"
                    maxlength="11"
                    class="p-2 border rounded-lg"
                  />
                  <input
                    type="text"
                    id="newStudentNumber"
                    placeholder="Öğrenci No"
                    class="p-2 border rounded-lg"
                  />
                </div>
                <button
                  onclick="addStudent()"
                  class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg w-full mt-3"
                >
                  ➕ Öğrenci Ekle
                </button>
              </div>
            </div>

            <!-- Test Assignment -->
            <div>
              <h4 class="font-bold mb-3">📋 Test Atama</h4>
              <div class="space-y-3">
                <select id="testSelect" class="w-full p-2 border rounded-lg">
                  <option value="">Test seçin...</option>
                </select>
                <select id="studentSelect" class="w-full p-2 border rounded-lg">
                  <option value="">Öğrenci seçin...</option>
                </select>
                <button
                  onclick="assignTest()"
                  class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg w-full"
                >
                  🎯 Test Ata
                </button>
              </div>

              <!-- Quick Stats -->
              <div class="mt-6 p-3 bg-blue-50 rounded-lg">
                <h5 class="font-bold text-blue-800 mb-2">📊 İstatistikler</h5>
                <div class="text-sm text-blue-700">
                  <div>Toplam Öğrenci: <span id="totalStudents">0</span></div>
                  <div>Toplam Test: <span id="totalTests">0</span></div>
                  <div>Aktif Atama: <span id="activeAssignments">0</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Results Panel -->
        <div id="resultsPanel" class="hidden bg-white rounded-lg shadow-md p-6">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">📊 Test Sonuçları</h3>
            <div class="flex gap-3 items-center">
              <select
                id="studentFilter"
                onchange="filterResultsByStudent()"
                class="p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Tüm Öğrenciler (Son 10)</option>
              </select>
              <button
                onclick="refreshResults()"
                class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors"
              >
                🔄 Paneli Yenile
              </button>
            </div>
          </div>
          <div id="resultsContent">
            <!-- Results will be populated here -->
          </div>
        </div>
      </div>

      <!-- Student Panel -->
      <div id="studentPanel" class="hidden">
        <div class="flex justify-between items-center mb-8">
          <div>
            <h2 class="text-3xl font-bold text-gray-800">👩‍🎓 Öğrenci Paneli</h2>
            <p class="text-sm text-gray-600 mt-1">
              Hoş geldin, <span id="studentNameDisplay" class="font-medium text-blue-600"></span>
            </p>
          </div>
          <div class="flex gap-3">
            <button
              onclick="refreshStudentPanel()"
              class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-medium transition-colors"
            >
              🔄 Paneli Yenile
            </button>
            <button
              onclick="showUserSelection()"
              class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg"
            >
              Geri Dön
            </button>
          </div>
        </div>

        <!-- Student Content -->
        <div class="grid lg:grid-cols-3 gap-6">
          <!-- Assigned Tests -->
          <div class="lg:col-span-2">
            <h3 class="text-xl font-bold mb-4">📝 Atanan Testler</h3>
            <div id="assignedTests" class="space-y-4">
              <!-- Assigned tests will be populated here -->
            </div>
          </div>

          <!-- Student Profile -->
          <div>
            <h3 class="text-xl font-bold mb-4">👤 Profilim</h3>
            <div id="studentProfile" class="bg-white rounded-lg shadow-md p-6">
              <!-- Profile will be populated here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Test Screen -->
      <div id="testScreen" class="hidden">
        <!-- Test content will be populated here -->
      </div>
    </div>

    <!-- Modals -->
    <div
      id="teacherLoginModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-lg p-8 w-96">
        <h3 class="text-2xl font-bold mb-4">Öğretmen Girişi</h3>
        <input
          type="text"
          id="username"
          placeholder="Kullanıcı Adı"
          class="w-full p-2 border rounded mb-4"
        />
        <input
          type="password"
          id="password"
          placeholder="Şifre"
          class="w-full p-2 border rounded mb-4"
        />
        <button
          onclick="teacherLogin()"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full"
        >
          Giriş Yap
        </button>
        <button
          onclick="hideTeacherLogin()"
          class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded w-full mt-2"
        >
          İptal
        </button>
      </div>
    </div>

    <div
      id="studentLoginModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-lg p-8 w-96">
        <h3 class="text-2xl font-bold mb-4">Öğrenci Girişi</h3>
        <select id="studentLoginSelect" class="w-full p-2 border rounded mb-4">
          <option value="">Öğrenci seçin...</option>
        </select>
        <button
          onclick="studentLogin()"
          class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full"
        >
          Giriş Yap
        </button>
        <button
          onclick="hideStudentLogin()"
          class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded w-full mt-2"
        >
          İptal
        </button>
      </div>
    </div>

    <div
      id="dataManagementModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-lg p-8 w-full max-w-2xl">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold">💾 Veri Yönetimi</h3>
          <button
            onclick="hideDataManagement()"
            class="text-gray-500 hover:text-gray-800 text-2xl"
          >
            &times;
          </button>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <!-- Local Data -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-bold mb-3">📊 Tarayıcı Verileri</h4>
            <div class="space-y-2 text-sm">
              <div>Öğrenciler: <span id="dataStatusStudents">0</span></div>
              <div>Testler: <span id="dataStatusTests">0</span></div>
              <div>Sonuçlar: <span id="dataStatusResults">0</span></div>
              <div>Profiller: <span id="dataStatusProfiles">0</span></div>
              <div class="mt-2 pt-2 border-t">
                Son Kayıt: <span id="lastSaveTime">Hiçbir zaman</span>
              </div>
            </div>
            <button
              onclick="manualSave()"
              class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded w-full mt-4"
            >
              💾 Manuel Kaydet
            </button>
          </div>

          <!-- Import/Export -->
          <div class="bg-gray-50 p-4 rounded-lg">
            <h4 class="font-bold mb-3">📤 İçe/Dışa Aktar</h4>
            <div class="space-y-3">
              <button
                onclick="exportAllData()"
                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded w-full"
              >
                📄 Tüm Veriyi Dışa Aktar
              </button>
              <div>
                <label
                  for="importFile"
                  class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded w-full text-center block cursor-pointer"
                  >📁 Veri İçe Aktar</label
                >
                <input
                  type="file"
                  id="importFile"
                  class="hidden"
                  onchange="importAllData(event)"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="mt-6 bg-red-50 p-4 rounded-lg">
          <h4 class="font-bold text-red-800 mb-2">🚨 Tehlikeli Alan</h4>
          <p class="text-sm text-red-700 mb-3">
            Bu işlem tüm verileri (öğrenciler, testler, sonuçlar) tarayıcı
            hafızasından kalıcı olarak siler. Bu işlem geri alınamaz!
          </p>
          <button
            onclick="clearAllData()"
            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full"
          >
            🗑️ Tüm Verileri Sil
          </button>
        </div>
      </div>
    </div>

    <div
      id="supabaseConfigModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden"
    >
      <div class="bg-white rounded-lg p-8 w-full max-w-lg">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold">🔧 Supabase Ayarları</h3>
          <button
            onclick="hideSupabaseConfig()"
            class="text-gray-500 hover:text-gray-800 text-2xl"
          >
            &times;
          </button>
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Supabase URL</label
            >
            <input
              type="text"
              id="supabaseUrl"
              placeholder="https://your-project-id.supabase.co"
              class="w-full p-2 border rounded-lg"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Supabase Anon Key</label
            >
            <input
              type="text"
              id="supabaseAnonKey"
              placeholder="eyJ..."
              class="w-full p-2 border rounded-lg"
            />
          </div>
        </div>

        <div class="mt-6 flex gap-4">
          <button
            onclick="saveSupabaseConfig( )"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex-1"
          >
            💾 Ayarları Kaydet
          </button>
          <button
            onclick="testSupabaseConnection()"
            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex-1"
          >
            🔗 Bağlantıyı Test Et
          </button>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let students = [];
      let tests = [];
      let testResults = {};
      let studentProfiles = {};
      let currentUser = null;
      let currentTest = null;
      let currentQuestionIndex = 0;
      let studentAnswers = {};
      let testStartTime;

      // Supabase configuration
      let useSupabase = false;
      let isSupabaseConfigured = false;

      // Teacher session management
      const TEACHER_SESSION_KEY = 'teacher_session';

      function saveTeacherSession() {
        const session = {
          loggedIn: true,
          timestamp: new Date().getTime(),
        };
        localStorage.setItem(TEACHER_SESSION_KEY, JSON.stringify(session));
      }

      function clearTeacherSession() {
        localStorage.removeItem(TEACHER_SESSION_KEY);
      }

      function isTeacherSessionActive() {
        const sessionData = localStorage.getItem(TEACHER_SESSION_KEY);
        if (!sessionData) return false;

        const session = JSON.parse(sessionData);
        const now = new Date().getTime();
        const sessionAge = now - session.timestamp;

        // 24 hours in milliseconds
        const maxSessionAge = 24 * 60 * 60 * 1000;

        if (session.loggedIn && sessionAge < maxSessionAge) {
          return true;
        }

        clearTeacherSession();
        return false;
      }

      // UI Navigation
      function showUserSelection() {
        document.getElementById('userSelection').classList.remove('hidden');
        document.getElementById('teacherPanel').classList.add('hidden');
        document.getElementById('studentPanel').classList.add('hidden');
        document.getElementById('testScreen').classList.add('hidden');
        hideTeacherLogin();
        hideStudentLogin();
      }

      function showTeacherPanel() {
        if (isTeacherSessionActive()) {
          document.getElementById('userSelection').classList.add('hidden');
          document.getElementById('teacherPanel').classList.remove('hidden');
        } else {
          showTeacherLogin();
        }
      }

      function showStudentPanel() {
        showStudentLogin();
      }

      function showTeacherLogin() {
        document.getElementById('teacherLoginModal').classList.remove('hidden');
      }

      function hideTeacherLogin() {
        document.getElementById('teacherLoginModal').classList.add('hidden');
      }

      function showStudentLogin() {
        populateStudentLoginSelect();
        document.getElementById('studentLoginModal').classList.remove('hidden');
      }

      function hideStudentLogin() {
        document.getElementById('studentLoginModal').classList.add('hidden');
      }

      function showTextInput() {
        document.getElementById('textInputModule').classList.remove('hidden');
        document.getElementById('studentManagement').classList.add('hidden');
        document.getElementById('resultsPanel').classList.add('hidden');
        setActiveTab(event.target);
      }

      function showStudentManagement() {
        document.getElementById('textInputModule').classList.add('hidden');
        document.getElementById('studentManagement').classList.remove('hidden');
        document.getElementById('resultsPanel').classList.add('hidden');
        setActiveTab(event.target);
      }

      function showResults() {
        document.getElementById('textInputModule').classList.add('hidden');
        document.getElementById('studentManagement').classList.add('hidden');
        document.getElementById('resultsPanel').classList.remove('hidden');
        setActiveTab(event.target);
        displayResults();
      }

      function setActiveTab(selectedTab) {
        const tabs = document.querySelectorAll('.teacher-tab');
        tabs.forEach((tab) => {
          tab.classList.remove('text-blue-600', 'border-blue-600');
          tab.classList.add('text-gray-500', 'hover:text-blue-600');
        });
        selectedTab.classList.add('text-blue-600', 'border-blue-600');
        selectedTab.classList.remove('text-gray-500', 'hover:text-blue-600');
      }

      // Teacher Login
      function teacherLogin() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if (username === 'admin' && password === '123456') {
          saveTeacherSession();
          document.getElementById('userSelection').classList.add('hidden');
          document.getElementById('teacherPanel').classList.remove('hidden');
          hideTeacherLogin();
        } else {
          alert('Hatalı kullanıcı adı veya şifre!');
        }
      }

      function teacherLogout() {
        if (confirm('Çıkış yapmak istediğinizden emin misiniz?')) {
          clearTeacherSession();
          showUserSelection();
        }
      }

      // Student Login
      function studentLogin() {
        const selectedStudent = document.getElementById('studentLoginSelect').value;
        if (selectedStudent) {
          currentUser = selectedStudent;
          document.getElementById('userSelection').classList.add('hidden');
          document.getElementById('studentPanel').classList.remove('hidden');
          document.getElementById('studentNameDisplay').textContent = currentUser;
          hideStudentLogin();
          displayAssignedTests();
          displayStudentProfile();
        } else {
          alert('Lütfen bir öğrenci seçin!');
        }
      }

      // Data Initialization
      function init() {
        loadDataFromStorage();
        populateStudentSelects();
        populateStudentFilter();
        updateStats();

        if (isTeacherSessionActive()) {
          showTeacherPanel();
        }

        // Check for Supabase config in localStorage
        const savedSupabaseUrl = localStorage.getItem('supabaseUrl');
        const savedSupabaseAnonKey = localStorage.getItem('supabaseAnonKey');

        if (savedSupabaseUrl && savedSupabaseAnonKey) {
          document.getElementById('supabaseUrl').value = savedSupabaseUrl;
          document.getElementById('supabaseAnonKey').value = savedSupabaseAnonKey;
          initializeSupabase(savedSupabaseUrl, savedSupabaseAnonKey);
        }
      }

      // Supabase Functions
      function showSupabaseConfig() {
        document.getElementById('supabaseConfigModal').classList.remove('hidden');
      }

      function hideSupabaseConfig() {
        document.getElementById('supabaseConfigModal').classList.add('hidden');
      }

      function saveSupabaseConfig() {
        const url = document.getElementById('supabaseUrl').value.trim();
        const key = document.getElementById('supabaseAnonKey').value.trim();

        if (url && key) {
          localStorage.setItem('supabaseUrl', url);
          localStorage.setItem('supabaseAnonKey', key);
          initializeSupabase(url, key);
          alert('Supabase ayarları kaydedildi!');
          hideSupabaseConfig();
        } else {
          alert('Lütfen hem URL hem de Anon Key girin.');
        }
      }

      async function testSupabaseConnection() {
        const url = document.getElementById('supabaseUrl').value.trim();
        const key = document.getElementById('supabaseAnonKey').value.trim();

        if (!url || !key) {
          alert('Lütfen önce URL ve Anon Key girin.');
          return;
        }

        try {
          const testSupabase = window.supabase.createClient(url, key);
          // A simple query to test the connection, e.g., fetching tables
          const { data, error } = await testSupabase.from('students').select('*').limit(1);

          if (error && error.message.includes('relation "public.students" does not exist')) {
             alert('Bağlantı başarılı, ancak "students" tablosu bulunamadı. Lütfen veritabanı tablolarını oluşturun.');
          } else if (error) {
            throw error;
          } else {
            alert('Supabase bağlantısı başarılı!');
          }
        } catch (error) {
          alert('Supabase bağlantısı başarısız: ' + error.message);
        }
      }

      // Data Persistence
      function saveDataToStorage() {
        const data = {
          students,
          tests,
          testResults,
          studentProfiles,
          lastSaved: new Date().toISOString(),
        };
        localStorage.setItem('okumaAnlamaTestSistemi', JSON.stringify(data));
      }

      function loadDataFromStorage() {
        const data = localStorage.getItem('okumaAnlamaTestSistemi');
        if (data) {
          const parsedData = JSON.parse(data);
          students = parsedData.students || [];
          tests = parsedData.tests || [];
          testResults = parsedData.testResults || {};
          studentProfiles = parsedData.studentProfiles || {};
        }
      }

      // Student Management
      function addStudent() {
        const studentName = document.getElementById('newStudentName').value.trim();
        const studentSurname = document.getElementById('newStudentSurname').value.trim();
        const studentTC = document.getElementById('newStudentTC').value.trim();
        const studentNumber = document.getElementById('newStudentNumber').value.trim();

        if (!studentName || !studentSurname || !studentTC || !studentNumber) {
          alert('Lütfen tüm öğrenci bilgilerini doldurun!');
          return;
        }

        const fullName = `${studentName} ${studentSurname}`;

        if (students.find((s) => s.name === fullName)) {
          alert('Bu isimde bir öğrenci zaten mevcut!');
          return;
        }

        const newStudent = {
          name: fullName,
          tc: studentTC,
          number: studentNumber,
        };

        students.push(newStudent);
        testResults[fullName] = [];
        studentProfiles[fullName] = { testsCompleted: 0, totalPoints: 0, averageStars: 0, badges: [] };

        populateStudentSelects();
        displayStudentList();
        updateStats();
        saveDataToStorage();

        document.getElementById('newStudentName').value = '';
        document.getElementById('newStudentSurname').value = '';
        document.getElementById('newStudentTC').value = '';
        document.getElementById('newStudentNumber').value = '';

        alert(`${fullName} adlı öğrenci başarıyla eklendi!`);
      }

      function displayStudentList() {
        const listElement = document.getElementById('studentList');
        listElement.innerHTML = '';
        students.forEach((student, index) => {
          const studentDiv = document.createElement('div');
          studentDiv.className = 'flex justify-between items-center p-2 bg-gray-100 rounded';
          studentDiv.innerHTML = `
            <span>${student.name}</span>
            <button onclick="deleteStudent(${index})" class="text-red-500 hover:text-red-700">Sil</button>
          `;
          listElement.appendChild(studentDiv);
        });
      }

      function deleteStudent(index) {
        const studentName = students[index].name;
        if (confirm(`${studentName} adlı öğrenciyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.`)) {
          students.splice(index, 1);
          delete testResults[studentName];
          delete studentProfiles[studentName];
          displayStudentList();
          populateStudentSelects();
          updateStats();
          saveDataToStorage();
          alert(`${studentName} adlı öğrenci silindi.`);
        }
      }

      function populateStudentSelects() {
        const studentSelect = document.getElementById('studentSelect');
        const studentLoginSelect = document.getElementById('studentLoginSelect');
        const studentFilter = document.getElementById('studentFilter');

        studentSelect.innerHTML = '<option value="">Öğrenci seçin...</option>';
        studentLoginSelect.innerHTML = '<option value="">Öğrenci seçin...</option>';
        studentFilter.innerHTML = '<option value="">Tüm Öğrenciler</option>';

        students.forEach((student) => {
          const option = document.createElement('option');
          option.value = student.name;
          option.textContent = student.name;
          studentSelect.appendChild(option.cloneNode(true));
          studentLoginSelect.appendChild(option.cloneNode(true));
          studentFilter.appendChild(option.cloneNode(true));
        });
      }

      // Test Management
      function generateTest() {
        // This is a placeholder for a more complex test generation logic
        const textContent = document.getElementById('textContent').value;
        if (textContent.length < 50) {
          alert('Lütfen en az 50 karakterlik bir metin girin.');
          return;
        }

        // Simple test generation: 3 multiple choice questions
        currentTest = {
          id: Date.now(),
          title: document.getElementById('textTitle').value || 'Yeni Test',
          text: textContent,
          textDisplayMode: document.querySelector('input[name="textDisplay"]:checked').value,
          questions: [
            {
              type: 'multiple',
              question: 'Metnin ana fikri nedir?',
              options: ['Seçenek A', 'Seçenek B', 'Seçenek C'],
              correct: 0,
            },
            {
              type: 'truefalse',
              question: 'Metinde geçen olaylar gerçektir.',
              correct: true,
            },
            {
              type: 'fillblank',
              question: 'Metindeki boşluğu doldurun: ______.',
              wordBank: ['kelime1', 'kelime2', 'kelime3'],
              correct: 'kelime1',
            },
          ],
        };

        displayTestPreview(currentTest);
      }

      function displayTestPreview(test) {
        const previewContent = document.getElementById('previewContent');
        previewContent.innerHTML = '';
        test.questions.forEach((q, index) => {
          const qDiv = document.createElement('div');
          qDiv.className = 'p-4 border rounded';
          qDiv.innerHTML = `<p class="font-bold">Soru ${index + 1}: ${q.question}</p>`;
          if (q.type === 'multiple') {
            q.options.forEach((opt, i) => {
              qDiv.innerHTML += `<div><input type="radio" disabled ${i === q.correct ? 'checked' : ''}> ${opt}</div>`;
            });
          }
          previewContent.appendChild(qDiv);
        });
        document.getElementById('testPreview').classList.remove('hidden');
      }

      function saveTest() {
        if (currentTest) {
          tests.push(currentTest);
          updateStats();
          saveDataToStorage();
          alert('Test başarıyla kaydedildi!');
          document.getElementById('testPreview').classList.add('hidden');
          document.getElementById('textTitle').value = '';
          document.getElementById('textContent').value = '';
          currentTest = null;
        } else {
          alert('Kaydedilecek bir test bulunmuyor.');
        }
      }

      function assignTest() {
        const testId = document.getElementById('testSelect').value;
        const studentName = document.getElementById('studentSelect').value;

        if (!testId || !studentName) {
          alert('Lütfen bir test ve bir öğrenci seçin.');
          return;
        }

        const test = tests.find((t) => t.id == testId);
        const studentTestResults = testResults[studentName] || [];

        if (studentTestResults.find((r) => r.testId == testId)) {
          alert('Bu test bu öğrenciye zaten atanmış!');
          return;
        }

        studentTestResults.push({
          testId: test.id,
          testTitle: test.title,
          assigned: true,
          completed: false,
          score: null,
        });

        testResults[studentName] = studentTestResults;
        updateStats();
        saveDataToStorage();
        alert(`${test.title} testi ${studentName} adlı öğrenciye atandı.`);
      }

      // Results Display
      function displayResults() {
        const resultsContent = document.getElementById('resultsContent');
        resultsContent.innerHTML = '';
        const studentFilter = document.getElementById('studentFilter').value;

        let resultsToDisplay = [];
        for (const studentName in testResults) {
          if (!studentFilter || studentFilter === studentName) {
            testResults[studentName].forEach(result => {
              if (result.completed) {
                resultsToDisplay.push({ studentName, ...result });
              }
            });
          }
        }

        resultsToDisplay.sort((a, b) => new Date(b.completionDate) - new Date(a.completionDate));
        resultsToDisplay = resultsToDisplay.slice(0, 10);

        if (resultsToDisplay.length === 0) {
          resultsContent.innerHTML = '<p class="text-gray-500">Gösterilecek sonuç bulunmuyor.</p>';
          return;
        }

        const table = document.createElement('table');
        table.className = 'w-full text-left border-collapse';
        table.innerHTML = `
          <thead>
            <tr>
              <th class="p-2 border-b">Öğrenci</th>
              <th class="p-2 border-b">Test</th>
              <th class="p-2 border-b">Puan</th>
              <th class="p-2 border-b">Tarih</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        `;

        const tbody = table.querySelector('tbody');
        resultsToDisplay.forEach(result => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="p-2 border-b">${result.studentName}</td>
            <td class="p-2 border-b">${result.testTitle}</td>
            <td class="p-2 border-b">${result.score}</td>
            <td class="p-2 border-b">${new Date(result.completionDate).toLocaleString('tr-TR')}</td>
          `;
          tbody.appendChild(row);
        });

        resultsContent.appendChild(table);
      }

      function filterResultsByStudent() {
        displayResults();
      }

      // Student Panel Functions
      function displayAssignedTests() {
        const assignedTestsDiv = document.getElementById('assignedTests');
        assignedTestsDiv.innerHTML = '';
        const studentTests = testResults[currentUser] || [];

        if (studentTests.length === 0) {
          assignedTestsDiv.innerHTML = '<p class="text-gray-500">Size atanmış bir test bulunmuyor.</p>';
          return;
        }

        studentTests.forEach(testResult => {
          const test = tests.find(t => t.id == testResult.testId);
          if (test) {
            const testCard = document.createElement('div');
            testCard.className = 'bg-white p-4 rounded-lg shadow flex justify-between items-center';
            testCard.innerHTML = `
              <div>
                <h4 class="font-bold">${test.title}</h4>
                <p class="text-sm text-gray-500">${testResult.completed ? `Puan: ${testResult.score}` : 'Bekliyor'}</p>
              </div>
              <button onclick="startTest('${test.id}')" class="bg-blue-500 text-white px-4 py-2 rounded" ${testResult.completed ? 'disabled' : ''}>
                ${testResult.completed ? 'Tamamlandı' : 'Başla'}
              </button>
            `;
            assignedTestsDiv.appendChild(testCard);
          }
        });
      }

      function displayStudentProfile() {
        const profileDiv = document.getElementById('studentProfile');
        const profile = studentProfiles[currentUser] || { testsCompleted: 0, totalPoints: 0, averageStars: 0, badges: [] };
        profileDiv.innerHTML = `
          <div class="text-center">
            <div class="text-4xl mb-2">⭐</div>
            <p class="text-lg font-bold">Ortalama Puan: ${profile.averageStars.toFixed(1)}</p>
            <p class="text-sm text-gray-500">Tamamlanan Test: ${profile.testsCompleted}</p>
          </div>
          <div class="mt-4">
            <h5 class="font-bold mb-2">Rozetler</h5>
            <div class="flex flex-wrap gap-2">
              ${profile.badges.map(b => `<span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full text-sm">${b}</span>`).join('') || '<p class="text-sm text-gray-500">Henüz rozet kazanılmadı.</p>'}
            </div>
          </div>
        `;
      }

      // Test Taking
      function startTest(testId) {
        currentTest = tests.find((t) => t.id == testId);
        if (currentTest) {
          currentQuestionIndex = 0;
          studentAnswers = {};
          testStartTime = new Date();
          document.getElementById('studentPanel').classList.add('hidden');
          document.getElementById('testScreen').classList.remove('hidden');
          displayQuestion();
        } else {
          alert('Test bulunamadı!');
        }
      }

      function displayQuestion() {
        const testScreen = document.getElementById('testScreen');
        const question = currentTest.questions[currentQuestionIndex];
        let questionHTML = `
          <div class="bg-white p-8 rounded-lg shadow-lg">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-2xl font-bold">${currentTest.title}</h3>
              <p class="text-gray-600">Soru ${currentQuestionIndex + 1} / ${currentTest.questions.length}</p>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
              <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${((currentQuestionIndex + 1) / currentTest.questions.length) * 100}%"></div>
            </div>
            <div class="grid ${currentTest.textDisplayMode === 'withQuestions' ? 'md:grid-cols-2 gap-8' : 'grid-cols-1'}">
        `;

        if (currentTest.textDisplayMode === 'withQuestions') {
          questionHTML += `
            <div>
              <h4 class="font-bold mb-2">Metin</h4>
              <div class="prose max-w-none h-96 overflow-y-auto p-4 bg-gray-50 rounded">${currentTest.text}</div>
            </div>
          `;
        }

        questionHTML += `
          <div>
            <h4 class="font-bold mb-2">Soru</h4>
            <p class="mb-4">${question.question}</p>
            <div class="space-y-2">
        `;

        if (question.type === 'multiple') {
          question.options.forEach((option, index) => {
            questionHTML += `
              <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="answer" value="${index}" class="mr-2">
                ${option}
              </label>
            `;
          });
        } else if (question.type === 'truefalse') {
          questionHTML += `
            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
              <input type="radio" name="answer" value="true" class="mr-2"> Doğru
            </label>
            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
              <input type="radio" name="answer" value="false" class="mr-2"> Yanlış
            </label>
          `;
        } else if (question.type === 'fillblank') {
          question.wordBank.forEach(word => {
            questionHTML += `
              <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
                <input type="radio" name="answer" value="${word}" class="mr-2"> ${word}
              </label>
            `;
          });
        }

        questionHTML += `
            </div>
            <div class="mt-6 flex justify-end">
              <button onclick="submitAnswer()" class="bg-blue-500 text-white px-6 py-2 rounded-lg">İlerle</button>
            </div>
          </div>
        </div>
      </div>
    `;

        testScreen.innerHTML = questionHTML;
      }

      function submitAnswer() {
        const selectedAnswer = document.querySelector('input[name="answer"]:checked');
        if (!selectedAnswer) {
          alert('Lütfen bir cevap seçin.');
          return;
        }

        studentAnswers[currentQuestionIndex] = selectedAnswer.value;

        if (currentQuestionIndex < currentTest.questions.length - 1) {
          currentQuestionIndex++;
          displayQuestion();
        } else {
          finishTest();
        }
      }

      function finishTest() {
        const testDuration = new Date() - testStartTime;
        let correctAnswers = 0;
        currentTest.questions.forEach((q, index) => {
          if (String(studentAnswers[index]) === String(q.correct)) {
            correctAnswers++;
          }
        });

        const score = Math.round((correctAnswers / currentTest.questions.length) * 100);

        const testResult = testResults[currentUser].find(r => r.testId == currentTest.id);
        if (testResult) {
          testResult.completed = true;
          testResult.score = score;
          testResult.completionDate = new Date().toISOString();
          testResult.duration = testDuration;
          testResult.answers = studentAnswers;
        }

        // Update student profile
        const profile = studentProfiles[currentUser];
        profile.testsCompleted++;
        profile.totalPoints += score;
        profile.averageStars = profile.totalPoints / profile.testsCompleted;

        // Award badges
        if (score === 100 && !profile.badges.includes('Mükemmel Puan')) {
          profile.badges.push('Mükemmel Puan');
        }
        if (profile.testsCompleted >= 5 && !profile.badges.includes('Çalışkan Öğrenci')) {
          profile.badges.push('Çalışkan Öğrenci');
        }

        saveDataToStorage();

        document.getElementById('testScreen').innerHTML = `
          <div class="bg-white p-8 rounded-lg shadow-lg text-center">
            <h3 class="text-3xl font-bold text-green-500 mb-4">Tebrikler, testi tamamladınız!</h3>
            <p class="text-xl mb-2">Puanınız: <span class="font-bold">${score}</span></p>
            <p class="text-gray-600 mb-6">Sonuçlarınız öğretmeninizle paylaşıldı.</p>
            <button onclick="showStudentPanel()" class="bg-blue-500 text-white px-6 py-2 rounded-lg">Panele Dön</button>
          </div>
        `;
      }

      // Utility Functions
      function updateStats() {
        document.getElementById('totalStudents').textContent = students.length;
        document.getElementById('totalTests').textContent = tests.length;

        let assignmentCount = 0;
        for (const student in testResults) {
          assignmentCount += testResults[student].filter(r => !r.completed).length;
        }
        document.getElementById('activeAssignments').textContent = assignmentCount;
      }

      function updateTextDisplayInfo() {
        const selectedMode = document.querySelector('input[name="textDisplay"]:checked').value;
        const infoDiv = document.getElementById('textDisplayInfo');
        let infoText = '';

        if (selectedMode === 'withQuestions') {
          infoText = '<strong>📄 Seçili Mod:</strong> Her soruyla birlikte metin gösterilecek. Bu klasik okuma-anlama test formatıdır.';
        } else if (selectedMode === 'firstPageOnly') {
          infoText = '<strong>📋 Seçili Mod:</strong> Öğrenci önce metni okuyacak, ardından sorulara geçecek. Metin, sorular sırasında tekrar gösterilmeyecek.';
        } else if (selectedMode === 'noText') {
          infoText = '<strong>🚫 Seçili Mod:</strong> Metin hiç gösterilmeyecek. Öğrenciler doğrudan soruları cevaplayacak. Bu, dinleme veya ön bilgi testleri için uygundur.';
        }

        infoDiv.innerHTML = `<div class="text-sm text-gray-700">${infoText}</div>`;
      }

      // Data Import/Export
      function exportAllData() {
        const data = {
          students,
          tests,
          testResults,
          studentProfiles,
        };
        const dataStr = JSON.stringify(data, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'okuma-anlama-verileri.json';
        a.click();
        URL.revokeObjectURL(url);
      }

      function importAllData(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            try {
              const data = JSON.parse(e.target.result);
              if (confirm('Mevcut verilerin üzerine yazmak istediğinizden emin misiniz?')) {
                students = data.students || [];
                tests = data.tests || [];
                testResults = data.testResults || {};
                studentProfiles = data.studentProfiles || {};
                saveDataToStorage();
                init();
                alert('Veriler başarıyla içe aktarıldı!');
              }
            } catch (error) {
              alert('Geçersiz dosya formatı.');
            }
          };
          reader.readAsText(file);
        }
      }

      function clearAllData() {
        if (confirm('TÜM VERİLERİ SİLMEK istediğinizden emin misiniz? Bu işlem geri alınamaz!')) {
          localStorage.removeItem('okumaAnlamaTestSistemi');
          students = [];
          tests = [];
          testResults = {};
          studentProfiles = {};
          init();
          alert('Tüm veriler silindi.');
        }
      }

      // Initialize the application when page loads
      window.onload = function () {
        init();
      };
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement('script');
            d.innerHTML =
              "window.__CF$cv$params={r:'9777e10057d9e325',t:'MTc1NjU5NDU2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName('head')[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement('iframe');
          a.height = 1;
          a.width = 1;
          a.style.position = 'absolute';
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = 'none';
          a.style.visibility = 'hidden';
          document.body.appendChild(a);
          if ('loading' !== document.readyState) c();
          else if (window.addEventListener)
            document.addEventListener('DOMContentLoaded', c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              'loading' !== document.readyState &&
                ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
